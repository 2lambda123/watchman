"use strict";(self.webpackChunkstaticdocs_starter=self.webpackChunkstaticdocs_starter||[]).push([[9048],{3905:function(e,t,n){n.r(t),n.d(t,{MDXContext:function(){return c},MDXProvider:function(){return p},mdx:function(){return h},useMDXComponents:function(){return m},withMDXComponents:function(){return d}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=a.createContext({}),d=function(e){return function(t){var n=m(t.components);return a.createElement(e,r({},t,{components:n}))}},m=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=m(e.components);return a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},f=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=m(n),p=i,f=d["".concat(o,".").concat(p)]||d[p]||u[p]||r;return n?a.createElement(f,s(s({ref:t},c),{},{components:n})):a.createElement(f,s({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=f;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},71128:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return m}});var a=n(83117),i=n(80102),r=(n(67294),n(3905)),o=["components"],s={title:"Case-Insensitivity",category:"Internals"},l=void 0,c={unversionedId:"casefolding",id:"casefolding",title:"Case-Insensitivity",description:"Watchman is currently completely unaware of case-insensitivity in file systems,",source:"@site/docs/casefolding.md",sourceDirName:".",slug:"/casefolding",permalink:"/watchman/docs/casefolding",draft:!1,editUrl:"https://github.com/facebook/watchman/tree/main/website/docs/casefolding.md",tags:[],version:"current",frontMatter:{title:"Case-Insensitivity",category:"Internals"},sidebar:"tutorialSidebar",previous:{title:"BSER Binary Protocol",permalink:"/watchman/docs/bser"},next:{title:"Contributing",permalink:"/watchman/docs/contributing"}},d={},m=[{value:"Why doesn&#39;t Watchman support case-folding properly?",id:"why-doesnt-watchman-support-case-folding-properly",level:2},{value:"Does this matter?",id:"does-this-matter",level:2},{value:"Credits",id:"credits",level:2}],p={toc:m};function u(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.mdx)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,"Watchman is currently completely unaware of case-insensitivity in file systems,\nand does not attempt to do any case-folding of file names. On a case-insensitive\nfile system like macOS's ",(0,r.mdx)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/HFS_Plus"},"HFS+"),", this\ncan manifest itself in different ways:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"If a file ",(0,r.mdx)("inlineCode",{parentName:"li"},"foo.txt")," is renamed to ",(0,r.mdx)("inlineCode",{parentName:"li"},"FOO.txt"),", Watchman will report ",(0,r.mdx)("inlineCode",{parentName:"li"},"FOO.txt")," as\ncreated and ",(0,r.mdx)("inlineCode",{parentName:"li"},"foo.txt")," separately as changed."),(0,r.mdx)("li",{parentName:"ul"},"If a file ",(0,r.mdx)("inlineCode",{parentName:"li"},"foo.txt")," is removed and another file ",(0,r.mdx)("inlineCode",{parentName:"li"},"FOO.txt")," is later added,\nWatchman will report ",(0,r.mdx)("inlineCode",{parentName:"li"},"FOO.txt")," as added, but it might report ",(0,r.mdx)("inlineCode",{parentName:"li"},"foo.txt")," as\neither removed or changed.")),(0,r.mdx)("p",null,"In general, both ",(0,r.mdx)("inlineCode",{parentName:"p"},"foo.txt")," and ",(0,r.mdx)("inlineCode",{parentName:"p"},"FOO.txt")," can be reported, sometimes with\ndifferent stat data, sometimes with the same stat data."),(0,r.mdx)("h2",{id:"why-doesnt-watchman-support-case-folding-properly"},"Why doesn't Watchman support case-folding properly?"),(0,r.mdx)("p",null,"One problem is that 'properly' is hard to pin down. There are at least four\nlevels of correctness here:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},"handle ASCII case-folding only (95% solution)"),(0,r.mdx)("li",{parentName:"ul"},"handle ASCII + accented ASCII case-folding only (98%)"),(0,r.mdx)("li",{parentName:"ul"},"full handling of current Unicode spec using a Unicode database (99%)"),(0,r.mdx)("li",{parentName:"ul"},"using the special folding table written to a hidden file on disk at file\nsystem creation time that matches Apple's interpretation of Unicode at the\ntime of the OS release + their own quirks (100%)")),(0,r.mdx)("p",null,"Clients of Watchman might have their own idea of case-folding, which might or\nmight not be compatible with Watchman's idea of it. So far, clients have managed\nto handle case-folding outside of Watchman, with some success."),(0,r.mdx)("h2",{id:"does-this-matter"},"Does this matter?"),(0,r.mdx)("p",null,"It depends on your application."),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Example 1:")," Your application is a build system that has a pre-baked list of\nfiles. Your application expects files to be on disk in the correct case even on\ncase-insensitive file systems, and you declare that the behavior is undefined if\nthey aren't. You invoke Watchman by asking it what files have changed. In this\ncase, Watchman should work without you having to do anything special."),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Example 2:")," Your application is a build system rule to generate CSS rules\nthat is run by a Watchman trigger on ",(0,r.mdx)("inlineCode",{parentName:"p"},"*.scss"),". You expect all files you care\nabout to end with the string ",(0,r.mdx)("inlineCode",{parentName:"p"},".scss")," on case-insensitive file systems, and not\nanother variant of it like ",(0,r.mdx)("inlineCode",{parentName:"p"},".SCSS"),". In this case, Watchman should work fine --\nat most, it will provide you the same file multiple times with different case\nvariants. You might be dealing with that in your build system anyway."),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Example 3:")," Like example 2, except you expect ",(0,r.mdx)("inlineCode",{parentName:"p"},".SCSS")," and other variants to\nwork too. In that case the only way is to explicitly add all possible variants\nto the trigger rule."),(0,r.mdx)("p",null,(0,r.mdx)("strong",{parentName:"p"},"Example 4:")," You're a source control system that has its own ideas about\ncase-folding that might or might not match up with the operating system's. You\nperform case-folding against an internal data structure, so that if the data\nstructure has ",(0,r.mdx)("inlineCode",{parentName:"p"},"foo.txt")," and the file system has ",(0,r.mdx)("inlineCode",{parentName:"p"},"FOO.txt")," you make ",(0,r.mdx)("inlineCode",{parentName:"p"},"foo.txt"),"\ntake precedence. In that case, Watchman will tell you about both ",(0,r.mdx)("inlineCode",{parentName:"p"},"FOO.txt")," and\n",(0,r.mdx)("inlineCode",{parentName:"p"},"foo.txt"),", and it's up to you to perform normalization.\n",(0,r.mdx)("a",{parentName:"p",href:"https://bitbucket.org/facebook/hgwatchman"},"hgwatchman")," just consults the file\nsystem in the rare case that a file changes case."),(0,r.mdx)("h2",{id:"credits"},"Credits"),(0,r.mdx)("p",null,"The levels of correctness were proposed by Matt Mackall ",(0,r.mdx)("a",{parentName:"p",href:"mailto:mpm@selenic.com"},"mpm@selenic.com"),"."))}u.isMDXComponent=!0}}]);