"use strict";(self.webpackChunkstaticdocs_starter=self.webpackChunkstaticdocs_starter||[]).push([[7331],{3905:function(e,t,n){n.r(t),n.d(t,{MDXContext:function(){return p},MDXProvider:function(){return d},mdx:function(){return f},useMDXComponents:function(){return s},withMDXComponents:function(){return c}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),c=function(e){return function(t){var n=s(t.components);return a.createElement(e,i({},t,{components:n}))}},s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,p=m(e,["components","mdxType","originalType","parentName"]),c=s(n),d=r,h=c["".concat(o,".").concat(d)]||c[d]||u[d]||i;return n?a.createElement(h,l(l({ref:t},p),{},{components:n})):a.createElement(h,l({ref:t},p))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=h;var l={};for(var m in t)hasOwnProperty.call(t,m)&&(l[m]=t[m]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},18137:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return m},default:function(){return u},frontMatter:function(){return l},metadata:function(){return p},toc:function(){return s}});var a=n(83117),r=n(80102),i=(n(67294),n(3905)),o=["components"],l={title:"watchman-make",category:"Invocation",sidebar_position:2},m=void 0,p={unversionedId:"watchman-make",id:"watchman-make",title:"watchman-make",description:"watchman-make is a convenience tool to help automatically invoke a build tool",source:"@site/docs/watchman-make.md",sourceDirName:".",slug:"/watchman-make",permalink:"/watchman/docs/watchman-make",draft:!1,editUrl:"https://github.com/facebook/watchman/tree/main/website/docs/watchman-make.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"watchman-make",category:"Invocation",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Command Line",permalink:"/watchman/docs/cli-options"},next:{title:"watchman-wait",permalink:"/watchman/docs/watchman-wait"}},c={},s=[{value:"Example",id:"example",level:3},{value:"Targets",id:"targets",level:3},{value:"Multiple Targets",id:"multiple-targets",level:3},{value:"Run Scripts",id:"run-scripts",level:3}],d={toc:s};function u(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.mdx)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," is a convenience tool to help automatically invoke a build tool\nor script in response to files changing. It is useful to automate building\nassets or running tests as you save files during development."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," will establish a watch on the files you specify and remain\nrunning in the foreground, waiting for changes to occur. When a change is\ntriggered, your build tool or script will be run in the foreground with its\noutput being passed through to your terminal session (or wherever you may have\nredirected it)."),(0,i.mdx)("p",null,"Events are consolidated and settled before they are dispatched to your build\ntool so that it won't start executing until after the files have stopped\nchanging. The ",(0,i.mdx)("inlineCode",{parentName:"p"},"--settle")," argument controls the settle duration."),(0,i.mdx)("p",null,(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," requires ",(0,i.mdx)("inlineCode",{parentName:"p"},"pywatchman")," (and thus requires ",(0,i.mdx)("inlineCode",{parentName:"p"},"python"),") as well as\n",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman"),"."),(0,i.mdx)("h3",{id:"example"},"Example"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-make -p '**/*.c' '**/*.h' 'Makefile*' -t all -p 'tests/**/*.py' 'tests/**/*.c' -t integration\n# Relative to /Users/wez/fb/watchman\n# Changes to files matching **/*.c **/*.h Makefile* will execute `make all`\n# Changes to files matching tests/**/*.py tests/**/*.c will execute `make integration`\n# waiting for changes\n")),(0,i.mdx)("h3",{id:"targets"},"Targets"),(0,i.mdx)("p",null,"You can tell ",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," about one or more build targets and their\ndependencies, and it will then trigger the build for those targets as changes\nare detected."),(0,i.mdx)("p",null,"The example above defines two targets using the ",(0,i.mdx)("inlineCode",{parentName:"p"},"-t")," argument; ",(0,i.mdx)("inlineCode",{parentName:"p"},"all")," and\n",(0,i.mdx)("inlineCode",{parentName:"p"},"integration"),". These correspond to targets with the same names in the watchman\n",(0,i.mdx)("inlineCode",{parentName:"p"},"Makefile"),". Each target will pick up the list of patterns defined by the ",(0,i.mdx)("inlineCode",{parentName:"p"},"-p"),"\nargument that precedes it."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-make -p '**/*.c' '**/*.h' -t all\n")),(0,i.mdx)("p",null,"The above defines a target named ",(0,i.mdx)("inlineCode",{parentName:"p"},"all")," that will be triggered whenever any\ncombination of files are changed that have filenames that match either of the\npatterns ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.c")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.h")," at any level in the directory tree (that's what the ",(0,i.mdx)("inlineCode",{parentName:"p"},"**"),"\nportion means). When it triggers, ",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," will execute ",(0,i.mdx)("inlineCode",{parentName:"p"},"make all"),"."),(0,i.mdx)("p",null,"If you don't use ",(0,i.mdx)("inlineCode",{parentName:"p"},"make"),", you can use the ",(0,i.mdx)("inlineCode",{parentName:"p"},"--make")," option to tell ",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make"),"\nto use your builder of choice. When a target is triggered, ",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," will\nconcatenate the value of ",(0,i.mdx)("inlineCode",{parentName:"p"},"--make")," with the name of the target and execute that\ncommand using the shell."),(0,i.mdx)("p",null,"The target name has no special meaning to ",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make"),", it is used only to\nconstruct the command to invoke. There is no special logic or support that is\nspecific to Makefiles or make."),(0,i.mdx)("h3",{id:"multiple-targets"},"Multiple Targets"),(0,i.mdx)("p",null,"There are two different ways to specify multiple targets. The first is shown in\nthe main example at the top of this page and is repeated here:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-make -p '*.c' '*.h' 'Makefile*' -t all -p 'tests/**/*.py' 'tests/**/*.c' -t integration\n")),(0,i.mdx)("p",null,"This defines two independent targets, ",(0,i.mdx)("inlineCode",{parentName:"p"},"all")," and ",(0,i.mdx)("inlineCode",{parentName:"p"},"integration")," that each have a\nlist of patterns defined as their triggers. Each time you specify a target using\nthe ",(0,i.mdx)("inlineCode",{parentName:"p"},"-t")," option, the value of the ",(0,i.mdx)("inlineCode",{parentName:"p"},"-p")," option is cleared."),(0,i.mdx)("p",null,"The above will cause ",(0,i.mdx)("inlineCode",{parentName:"p"},"make all")," to be run if you change a file that matches\n",(0,i.mdx)("inlineCode",{parentName:"p"},".*c")," (at the top level of the tree), and will cause ",(0,i.mdx)("inlineCode",{parentName:"p"},"make integration")," to run\nif you change a source file under the tests directory."),(0,i.mdx)("p",null,"An alternative is to list multiple target names with your ",(0,i.mdx)("inlineCode",{parentName:"p"},"-t")," option:"),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-make -p '*.c' '*.h' 'Makefile*' 'tests/**/*.py' 'tests/**/*.c' -t all integration\n")),(0,i.mdx)("p",null,"this will execute ",(0,i.mdx)("inlineCode",{parentName:"p"},"make all integration")," if you change any top level ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.c")," file\n",(0,i.mdx)("em",{parentName:"p"},"or")," test source file."),(0,i.mdx)("h3",{id:"run-scripts"},"Run Scripts"),(0,i.mdx)("p",null,(0,i.mdx)("em",{parentName:"p"},"Since 4.8.")),(0,i.mdx)("p",null,"As an alternative to targets, you can provide the path to a script which\n",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," will execute when changes are detected."),(0,i.mdx)("pre",null,(0,i.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-make -p '**/*.c' '**/*.h' --run my_script.sh\n")),(0,i.mdx)("p",null,"The above will run the provided script whenever any combination of files are\nchanged that have filenames that match either of the patterns ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.c")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"*.h")," at\nany level in the directory tree. When it triggers, ",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," will execute\n",(0,i.mdx)("inlineCode",{parentName:"p"},"my_script.sh"),"."),(0,i.mdx)("p",null,"You must run ",(0,i.mdx)("inlineCode",{parentName:"p"},"watchman-make")," with either ",(0,i.mdx)("inlineCode",{parentName:"p"},"--target")," or ",(0,i.mdx)("inlineCode",{parentName:"p"},"--run"),", but they cannot\nbe run together"))}u.isMDXComponent=!0}}]);