"use strict";(self.webpackChunkstaticdocs_starter=self.webpackChunkstaticdocs_starter||[]).push([[3205],{3905:function(e,t,n){n.r(t),n.d(t,{MDXContext:function(){return s},MDXProvider:function(){return c},mdx:function(){return f},useMDXComponents:function(){return p},withMDXComponents:function(){return d}});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),d=function(e){return function(t){var n=p(t.components);return a.createElement(e,r({},t,{components:n}))}},p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,s=m(e,["components","mdxType","originalType","parentName"]),d=p(n),c=i,h=d["".concat(o,".").concat(c)]||d[c]||u[c]||r;return n?a.createElement(h,l(l({ref:t},s),{},{components:n})):a.createElement(h,l({ref:t},s))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=h;var l={};for(var m in t)hasOwnProperty.call(t,m)&&(l[m]=t[m]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},97525:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return m},default:function(){return u},frontMatter:function(){return l},metadata:function(){return s},toc:function(){return p}});var a=n(83117),i=n(80102),r=(n(67294),n(3905)),o=["components"],l={title:"watchman-wait",category:"Invocation",sidebar_position:3},m=void 0,s={unversionedId:"watchman-wait",id:"watchman-wait",title:"watchman-wait",description:"watchman-wait waits for changes to files. It uses the watchman service to",source:"@site/docs/watchman-wait.md",sourceDirName:".",slug:"/watchman-wait",permalink:"/watchman/docs/watchman-wait",draft:!1,editUrl:"https://github.com/facebook/watchman/tree/main/website/docs/watchman-wait.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"watchman-wait",category:"Invocation",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"watchman-make",permalink:"/watchman/docs/watchman-make"},next:{title:"watchman-replicate-subscription",permalink:"/watchman/docs/watchman-replicate-subscription"}},d={},p=[{value:"Paths and Patterns",id:"paths-and-patterns",level:3},{value:"Controlling lifetime",id:"controlling-lifetime",level:3},{value:"Controlling output",id:"controlling-output",level:3},{value:"Exit Status",id:"exit-status",level:3}],c={toc:p};function u(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.mdx)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," waits for changes to files. It uses the watchman service to\nefficiently and recursively watch your specified list of paths."),(0,r.mdx)("p",null,"It is suitable for waiting for changes to files from shell scripts. It has some\nsimilarity to ",(0,r.mdx)("inlineCode",{parentName:"p"},"inotifywait")," except that it uses the watchman service to watch\nfiles and thus can be used on any of the operating systems supported by\nwatchman, not just Linux."),(0,r.mdx)("p",null,"It can stop after a configurable number of events are observed. The default is a\nsingle event. You may also remove the limit and allow it to execute\ncontinuously."),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," will print one event per line. The event information includes\nyour specified list of fields, with each field separated by a space (or your\nchoice of ",(0,r.mdx)("inlineCode",{parentName:"p"},"--separator"),")."),(0,r.mdx)("p",null,"Events are consolidated and settled by the watchman server before they are\ndispatched to ",(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," so that your script won't start executing until\nafter the files have stopped changing."),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," requires ",(0,r.mdx)("inlineCode",{parentName:"p"},"pywatchman")," (and thus requires ",(0,r.mdx)("inlineCode",{parentName:"p"},"python"),") as well as\n",(0,r.mdx)("inlineCode",{parentName:"p"},"watchman"),"."),(0,r.mdx)("h3",{id:"paths-and-patterns"},"Paths and Patterns"),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-wait path [path ...]\n")),(0,r.mdx)("p",null,"The primary unit of watching is a path. You must specify a list of one or more\npaths that you'd like to wait for. Paths can be files or directories. Each of\nthe paths in your list must exist at the time that you invoke ",(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," or\nan error will be reported and ",(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," will exit."),(0,r.mdx)("p",null,"If you'd like to wait for a file to be created you can watch the directory in\nwhich it will be created. You may further refine your watch by limiting it to a\nset of patterns."),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-wait . -p '*.so'\n")),(0,r.mdx)("pre",null,(0,r.mdx)("code",{parentName:"pre",className:"language-bash"},"$ watchman-wait -p '*.so' -- .\n")),(0,r.mdx)("p",null,"Both of the above will wait for a shared object file to be changed in any path\nunder the current working directory. Since both the ",(0,r.mdx)("inlineCode",{parentName:"p"},"-p")," option and the list of\npaths accept one or more parameters, the second form shows how to disambiguate\nbetween the list of patterns and the list of paths using the ",(0,r.mdx)("inlineCode",{parentName:"p"},"--")," separator."),(0,r.mdx)("p",null,"Patterns are wildmatch style globs that support recursive matching via the ",(0,r.mdx)("inlineCode",{parentName:"p"},"**"),"\nplaceholder."),(0,r.mdx)("p",null,"You should always quote your pattern parameters so that they are not evaluated\nby your shell."),(0,r.mdx)("h3",{id:"controlling-lifetime"},"Controlling lifetime"),(0,r.mdx)("p",null,"There are two primary controls for how long ",(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," will run:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"-t")," or ",(0,r.mdx)("inlineCode",{parentName:"li"},"--timeout")," places a time limit on execution"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"-m")," or ",(0,r.mdx)("inlineCode",{parentName:"li"},"--max-events")," places a limit on the number of events to process")),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," will terminate when either the timeout is hit or the max events\nlimit is hit."),(0,r.mdx)("p",null,"By default there is no time limit, but there is a default limit of a single\nevent."),(0,r.mdx)("p",null,"You may specify ",(0,r.mdx)("inlineCode",{parentName:"p"},"--max-events 0")," to disable the event limit."),(0,r.mdx)("h3",{id:"controlling-output"},"Controlling output"),(0,r.mdx)("p",null,(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," will output one line per event. The following options influence\nthe output:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"--fields NAME,NAME")," - specifies the list of fields to be printed for each\nevent. The default is ",(0,r.mdx)("inlineCode",{parentName:"li"},"--fields name")," which will print just the ",(0,r.mdx)("inlineCode",{parentName:"li"},"name")," of the\nfile that was changed. You may use any of the available fields listed in\n",(0,r.mdx)("a",{parentName:"li",href:"/watchman/docs/cmd/query#available-fields"},"available fields"),". The fields will be printed\nin the order you list them."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"--relative DIR")," - the ",(0,r.mdx)("inlineCode",{parentName:"li"},"name")," field will be adjusted to be relative to ",(0,r.mdx)("inlineCode",{parentName:"li"},"DIR"),"\nbefore it is printed out. The default for ",(0,r.mdx)("inlineCode",{parentName:"li"},"DIR")," is the current working\ndirectory when ",(0,r.mdx)("inlineCode",{parentName:"li"},"watchman-wait")," is started."),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"--separator STRING")," - if you specified multiple fields, the separator string\nwill be used when printing them. The default is ",(0,r.mdx)("inlineCode",{parentName:"li"},'--separator " "')," which will\nprint the fields with spaces between them.")),(0,r.mdx)("h3",{id:"exit-status"},"Exit Status"),(0,r.mdx)("p",null,"The following exit status codes can be used to determine what caused\n",(0,r.mdx)("inlineCode",{parentName:"p"},"watchman-wait")," to exit:"),(0,r.mdx)("ul",null,(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"0")," is returned after successfully waiting for event(s)"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"1")," in case of a runtime error of some kind"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"2")," the ",(0,r.mdx)("inlineCode",{parentName:"li"},"-t"),"/",(0,r.mdx)("inlineCode",{parentName:"li"},"--timeout")," option was used and that amount of time passed before\nan event was received"),(0,r.mdx)("li",{parentName:"ul"},(0,r.mdx)("inlineCode",{parentName:"li"},"3")," if execution was interrupted (Ctrl-C)")))}u.isMDXComponent=!0}}]);