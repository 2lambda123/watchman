<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-troubleshooting">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Troubleshooting | Watchman</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://facebook.github.io/watchman/img/watchman-social-card.png"><meta data-rh="true" name="twitter:image" content="https://facebook.github.io/watchman/img/watchman-social-card.png"><meta data-rh="true" property="og:url" content="https://facebook.github.io/watchman/docs/troubleshooting"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Troubleshooting | Watchman"><meta data-rh="true" name="description" content="We try to give directed advice in Watchman error diagnostics, which means that"><meta data-rh="true" property="og:description" content="We try to give directed advice in Watchman error diagnostics, which means that"><link data-rh="true" rel="icon" href="/watchman/img/favicon.png"><link data-rh="true" rel="canonical" href="https://facebook.github.io/watchman/docs/troubleshooting"><link data-rh="true" rel="alternate" href="https://facebook.github.io/watchman/docs/troubleshooting" hreflang="en"><link data-rh="true" rel="alternate" href="https://facebook.github.io/watchman/docs/troubleshooting" hreflang="x-default"><link rel="stylesheet" href="/watchman/assets/css/styles.020fe8fb.css">
<link rel="preload" href="/watchman/assets/js/runtime~main.9f7e7ff6.js" as="script">
<link rel="preload" href="/watchman/assets/js/main.eda62e9f.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/watchman/"><div class="navbar__logo"><img src="/watchman/img/logo.png" alt="Watchman Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/watchman/img/logo.png" alt="Watchman Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Watchman</b></a><a class="navbar__item navbar__link" href="/watchman/docs/install">Documentation</a><a class="navbar__item navbar__link" href="/watchman/support">Support</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/watchman" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/watchman/docs/install">Installation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/watchman/docs/cli-options">Invocation</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/watchman/docs/capabilities">Compatibility</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/watchman/docs/cmd/clock">Commands</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/watchman/docs/clockspec">Queries</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/watchman/docs/expr/allof">Expression Terms</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/watchman/docs/bser">Internals</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/watchman/docs/troubleshooting">Troubleshooting</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/watchman/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Troubleshooting</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Troubleshooting</h1></header><p>We try to give directed advice in Watchman error diagnostics, which means that
we will show a link to a section on this page with some context and advice where
we have enough information to do so. Some operating systems provide richer
diagnostic information than others, so we have to resort to more generic advice
in some cases.</p><p>The most common cause of problems is hitting system resource limits. There are
finite resources available for filesystem watching, and when they are exceeded
it can impact performance in the best case or prohibit correct operation in the
worst case.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ensure-that-you-are-on-the-best-available-version">Ensure that you are on the best available version<a class="hash-link" href="#ensure-that-you-are-on-the-best-available-version" title="Direct link to heading">​</a></h2><p>It is generally a good idea to make sure that you are using the latest version
of the software, so that you avoid any known issues.</p><p>If you are running a pre-built binary provided by your operating system
distribution system, there is a chance that you&#x27;ll need to build the latest
version from source. You can find instructions for this in
<a href="/watchman/docs/install">the installation section</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recrawl">Recrawl<a class="hash-link" href="#recrawl" title="Direct link to heading">​</a></h2><p>A recrawl is an action that Watchman performs in order to recover from
situations where it believes that it has lost sync with the state of the
filesystem.</p><p>The most common cause for a recrawl is on Linux systems where the default
inotify limits are sized quite small. What this means is that the rate at which
your watched roots are generating changes is higher than the kernel can buffer
and relay to the watchman service. When this happens, the kernel detects the
overflow and signals <code>IN_Q_OVERFLOW</code>. The recovery is to recursively scan the
root to make sure that we know what is really there and re-sync with the
notification stream.</p><p>Frequent recrawls are undesirable because they result in a potentially expensive
full tree crawl, which marks all files as changed and propagates this status to
clients which will in turn perform some action on the (likely falsely) changed
state of the majority of files.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="avoiding-recrawls">Avoiding Recrawls<a class="hash-link" href="#avoiding-recrawls" title="Direct link to heading">​</a></h3><p>There is no simple formula for setting your system limits; bigger is better but
comes at the cost of kernel memory to maintain the buffers. You and/or your
system administrator should review the workload for your system and the
<a href="/watchman/docs/install#system-specific-preparation">System Specific Preparation Documentation</a>
and raise your limits accordingly.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kfseventstreameventflaguserdropped">kFSEventStreamEventFlagUserDropped<a class="hash-link" href="#kfseventstreameventflaguserdropped" title="Direct link to heading">​</a></h3><p>macOS has a similar internal limit and behavior when that limit is exceeded. If
you&#x27;re encountering a message like:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Recrawled this watch 1 times, most recently because:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/some/path: kFSEventStreamEventFlagUserDropped</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then you are hitting the limits of your system. There is no direct control over
the limit, but starting in Watchman 3.2 you may increase the
<a href="/watchman/docs/config#fsevents-latency">fsevents_latency</a> parameter in your
<code>.watchmanconfig</code> file.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ive-changed-my-limits-how-can-i-clear-the-warning">I&#x27;ve changed my limits, how can I clear the warning?<a class="hash-link" href="#ive-changed-my-limits-how-can-i-clear-the-warning" title="Direct link to heading">​</a></h3><p>The warning will stick until you cancel the watch and reinstate it, or restart
the watchman process. The simplest resolution is to run
<code>watchman shutdown-server</code> and re-establish your watch on your next watchman
query.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="where-are-the-logs">Where are the logs?<a class="hash-link" href="#where-are-the-logs" title="Direct link to heading">​</a></h2><p>Watchman places logs in a file named <code>&lt;STATEDIR&gt;/&lt;USER&gt;.log</code>, where <code>STATEDIR</code>
is set at the time that you built watchman.</p><p>If you used the <code>--enable-statedir=&lt;STATEDIR&gt;</code> configure option, that will be
the location that holds your logs. If not, the default for <code>STATEDIR</code> will be
<code>&lt;PREFIX&gt;/var/run/watchman</code>, or for older versions of watchman, the logs may be
placed in <code>&lt;TMPDIR&gt;/.watchman.&lt;USER&gt;.log</code>.</p><p><em>Since 3.8.</em></p><p>Watchman places the logs in a file named <code>&lt;STATEDIR&gt;/log</code>, which will typically
be a location like <code>&lt;PREFIX&gt;/var/run/watchman/&lt;USER&gt;-state/log</code>. If you&#x27;re
running a <code>homebrew</code> build of watchman, <code>&lt;PREFIX&gt;</code> is usually <code>/usr/local</code>.</p><p>The default log location may be overridden by the <code>--logfile</code>
<a href="/watchman/docs/cli-options#server-options">Server Option</a>.</p><p><a href="/watchman/docs/cli-options#quick-note-on-default-locations">Quick note on default locations</a>
explains what we mean by <code>&lt;STATEDIR&gt;</code>, <code>&lt;TMPDIR&gt;</code>, <code>&lt;USER&gt;</code> and so on.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="poison-inotify_add_watch"><a id="poison-inotify-add-watch"></a>Poison: inotify_add_watch<a class="hash-link" href="#poison-inotify_add_watch" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A non-recoverable condition has triggered.  Watchman needs your help!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The triggering condition was at timestamp=1407695600: inotify-add-watch(/my/path) -&gt; Cannot allocate memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">All requests will continue to fail with this message until you resolve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the underlying problem.  You will find more information on fixing this at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://facebook.github.io/watchman/docs/troubleshooting.html#poison-inotify-add-watch</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you&#x27;ve encountered this state it means that your <em>kernel</em> was unable to watch
a dir in one or more of the roots you&#x27;ve asked it to watch. This particular
condition is considered non-recoverable by Watchman on the basis that nothing
that the Watchman service can do can guarantee that the root cause is resolved,
and while the system is in this state, Watchman cannot guarantee that it can
respond with the correct results that its clients depend upon. We consider
ourselves poisoned and will fail all requests for all watches (not just the
watch that it triggered on) until the process is restarted.</p><p>There are two primary reasons that this can trigger:</p><ul><li>The user limit on the total number of inotify watches was reached or the
kernel failed to allocate a needed resource</li><li>Insufficient kernel memory was available</li></ul><p>The resolution for the former is to revisit
<a href="/watchman/docs/install#system-specific-preparation">System Specific Preparation Documentation</a>
and raise your limits accordingly.</p><p>The latter condition implies that your workload is exceeding the available RAM
on the machine. It is difficult to give specific advice to resolve this
condition here; you may be able to tune down other system limits to free up some
resources, or you may just need to install more RAM in the system.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ive-changed-my-limits-how-can-i-clear-the-error">I&#x27;ve changed my limits, how can I clear the error?<a class="hash-link" href="#ive-changed-my-limits-how-can-i-clear-the-error" title="Direct link to heading">​</a></h3><p>The error will stick until you restart the watchman process. The simplest
resolution is:</p><p><em>Since 4.6</em></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ watchman watch-del-all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ watchman shutdown-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Before 4.6</em></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">STATEDIR</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">/state       </span><span class="token comment" style="color:#999988;font-style:italic"># see above for what STATEDIR means</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ watchman --no-spawn --no-local shutdown-server</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you have not actually resolved the root cause you may continue to trigger and
experience this state each time the system trips over these limits.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="poison-opendir">Poison: opendir<a class="hash-link" href="#poison-opendir" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">A non-recoverable condition has triggered.  Watchman needs your help!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The triggering condition was at timestamp=1407695600: opendir(/my/path) -&gt; Too many open files in system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">All requests will continue to fail with this message until you resolve</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the underlying problem.  You will find more information on fixing this at</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">https://facebook.github.io/watchman/docs/troubleshooting.html#opendir</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you&#x27;ve encountered this state it means that your entire system had too many
open files, and that this prevented watchman from tracking the changes on your
system. In this case, the error isn&#x27;t related to filesystem watching but to
other (likely) misbehaving processes on your system; it&#x27;s usually indicative of
a runaway program or set of programs consuming resources, but in some cases it
may just be that your system workload requires that you increase your system
limits for the number of files.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-resolve-this">How do I resolve this?<a class="hash-link" href="#how-do-i-resolve-this" title="Direct link to heading">​</a></h3><p><a href="/watchman/docs/troubleshooting#i-39-ve-changed-my-limits-how-can-i-clear-the-error">Follow these directions</a></p><p>If the issue persists, consult your system administrator to identify what is
consuming these resources and remediate it, or to increase your system limits.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="fsevents">FSEvents<a class="hash-link" href="#fsevents" title="Direct link to heading">​</a></h2><p>FSEvents is the file watching facility on macOS. There are few diagnostics that
can help diagnose issues with FSEvents; the API itself gives little feedback on
a number of error cases and instead emits rather cryptic error messages to the
log file.</p><p>If you got here because an error message told you to read this section, it will
have also asked you to look at your log file. If you are using an older version
of watchman and encounter the error message <code>FSEventStreamStart failed</code>, then
you should locate your log file (see <a href="#where-are-the-logs">Where are the logs?</a>
above) and look for lines that mention FSEvents and then consult the information
below.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fseventstreamstart-register_with_server-error-f2d_register_rpc--null--21">FSEventStreamStart: register_with_server: ERROR: f2d_register_rpc() =&gt; (null) (-21)<a class="hash-link" href="#fseventstreamstart-register_with_server-error-f2d_register_rpc--null--21" title="Direct link to heading">​</a></h3><p>Nobody outside of Apple is sure what precisely this means, but it indicates that
the fsevents service has gotten in a bad state. Possible reasons for this may
include:</p><ul><li>There are too many event stream clients</li><li>One or more event stream clients has gotten in a bad state and is somehow
impacting the fsevents service</li></ul><p>To resolve this issue, you may wish to try the following, which are
progressively more invasive:</p><ul><li>Avoid establishing multiple overlapping watches within the same filesystem
tree, especially for large trees. We recommend watching only the root of a
project or repo and not watching sub-trees within that tree. Organizations
with large trees may wish to deploy the
<a href="/watchman/docs/config#root-restrict-files">root_restrict_files</a> configuration option so
that watchman will only allow watching project roots.</li><li>Close or restart other applications that are using fsevents. Some examples
are:</li><li>editors such as Sublime Text and TextMate.</li><li>Many nodejs packages and Grunt style workflows make use of fsevents. Make sure
that you upgrade nodejs to at least version <code>v0.11.14</code>. If possible, configure
your nodejs packages to use either <a href="https://www.npmjs.com/package/sane" target="_blank" rel="noopener noreferrer">sane</a>
or <a href="https://www.npmjs.com/package/fb-watchman" target="_blank" rel="noopener noreferrer">fb-watchman</a> for file watching
as this will consolidate the number of fsevents watches down to just the set
maintained by watchman.</li><li>Restart the fsevents service: <code>sudo pkill -9 -x fseventsd</code></li><li>Restart your computer</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="triggerssubscriptions-dont-fire-on-macos">Triggers/Subscriptions don&#x27;t fire on macOS<a class="hash-link" href="#triggerssubscriptions-dont-fire-on-macos" title="Direct link to heading">​</a></h2><p>There is a rare fsevents bug that can prevent any notifications from working in
directories where the case of the name of a directory in the kernel has an
inconsistency.</p><p>You can test whether this is happening to you by following
<a href="https://github.com/andreyvit/find-fsevents-bugs" target="_blank" rel="noopener noreferrer">the instructions for the find-fsevents-bugs tool</a>.</p><p>If it is happening to you, the resolution is to rename the directories
highlighted by the tool.</p><p>You can read more about this issue in the following resources:</p><ul><li><a href="http://feedback.livereload.com/knowledgebase/articles/86239-os-x-fsevents-bug-may-prevent-monitoring-of-certai" target="_blank" rel="noopener noreferrer">Knowledge base article for LiveReload</a></li><li><a href="https://github.com/thibaudgg/rb-fsevent/issues/10" target="_blank" rel="noopener noreferrer">issue for the Ruby fsevents module</a></li><li><a href="http://openradar.appspot.com/10207999" target="_blank" rel="noopener noreferrer">Open Radar bug report</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reactnative-watcher-took-too-long-to-load">ReactNative: Watcher took too long to load<a class="hash-link" href="#reactnative-watcher-took-too-long-to-load" title="Direct link to heading">​</a></h2><p>There was an issue that was the result of umask affecting the permissions of the
launchd plist file that Watchman uses to set up your watchman service on OS X.
This issue was resolved in Watchman version 3.1.</p><p>To update:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ watchman shutdown-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ brew update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ brew reinstall watchman</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/watchman/tree/main/website/docs/troubleshooting.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/watchman/docs/cookies"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Query Synchronization</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ensure-that-you-are-on-the-best-available-version" class="table-of-contents__link toc-highlight">Ensure that you are on the best available version</a></li><li><a href="#recrawl" class="table-of-contents__link toc-highlight">Recrawl</a><ul><li><a href="#avoiding-recrawls" class="table-of-contents__link toc-highlight">Avoiding Recrawls</a></li><li><a href="#kfseventstreameventflaguserdropped" class="table-of-contents__link toc-highlight">kFSEventStreamEventFlagUserDropped</a></li><li><a href="#ive-changed-my-limits-how-can-i-clear-the-warning" class="table-of-contents__link toc-highlight">I&#39;ve changed my limits, how can I clear the warning?</a></li></ul></li><li><a href="#where-are-the-logs" class="table-of-contents__link toc-highlight">Where are the logs?</a></li><li><a href="#poison-inotify_add_watch" class="table-of-contents__link toc-highlight"><a id="poison-inotify-add-watch"></a>Poison: inotify_add_watch</a><ul><li><a href="#ive-changed-my-limits-how-can-i-clear-the-error" class="table-of-contents__link toc-highlight">I&#39;ve changed my limits, how can I clear the error?</a></li></ul></li><li><a href="#poison-opendir" class="table-of-contents__link toc-highlight">Poison: opendir</a><ul><li><a href="#how-do-i-resolve-this" class="table-of-contents__link toc-highlight">How do I resolve this?</a></li></ul></li><li><a href="#fsevents" class="table-of-contents__link toc-highlight">FSEvents</a><ul><li><a href="#fseventstreamstart-register_with_server-error-f2d_register_rpc--null--21" class="table-of-contents__link toc-highlight">FSEventStreamStart: register_with_server: ERROR: f2d_register_rpc() =&gt; (null) (-21)</a></li></ul></li><li><a href="#triggerssubscriptions-dont-fire-on-macos" class="table-of-contents__link toc-highlight">Triggers/Subscriptions don&#39;t fire on macOS</a></li><li><a href="#reactnative-watcher-took-too-long-to-load" class="table-of-contents__link toc-highlight">ReactNative: Watcher took too long to load</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/watchman/docs/install">Documentation</a></li><li class="footer__item"><a href="https://github.com/facebook/watchman" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/watchman/docs/troubleshooting">Getting Support</a></li></ul></div><div class="col footer__col"><div class="footer__title">Related Projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://sapling-scm.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sapling<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.fb.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/data-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Data Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.fb.com/legal/cookie-policy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cookie Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.fb.com" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/watchman/img/meta_opensource_logo_negative.svg" alt="Meta Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/watchman/img/meta_opensource_logo_negative.svg" alt="Meta Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2023 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/watchman/assets/js/runtime~main.9f7e7ff6.js"></script>
<script src="/watchman/assets/js/main.eda62e9f.js"></script>
</body>
</html>